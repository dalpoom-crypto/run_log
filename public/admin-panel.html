<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RunLog Admin - ê´€ë¦¬ì í˜ì´ì§€</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #64748b; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: {
              50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1',
              400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155',
              800: '#1e293b', 900: '#0f172a',
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-navy-50">
  <div id="admin-root"></div>

  <!-- Firebase ì´ˆê¸°í™” -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getAuth, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
    import { getFirestore, collection, query, where, orderBy, getDocs, limit, doc, getDoc, updateDoc, deleteDoc, setDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyA4KFdLVKVy6WdAfTGuLWDJsV_tcuNp7kw",
      authDomain: "run-log-31420.firebaseapp.com",
      projectId: "run-log-31420",
      storageBucket: "run-log-31420.firebasestorage.app",
      messagingSenderId: "325067679087",
      appId: "1:325067679087:web:727201211a34ac6c1fb49a",
    };

    const app = initializeApp(firebaseConfig);
    window.firebaseAuth = getAuth(app);
    window.firebaseDb = getFirestore(app);
    window.firebaseModules = { signOut, onAuthStateChanged, collection, query, where, orderBy, getDocs, limit, doc, getDoc, updateDoc, deleteDoc, setDoc, Timestamp };
  </script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const auth = window.firebaseAuth;
    const db = window.firebaseDb;
    const { signOut, onAuthStateChanged, collection, query, where, orderBy, getDocs, limit, doc, getDoc, updateDoc, deleteDoc, setDoc, Timestamp } = window.firebaseModules;


    // ========== useAdminAuth Hook ==========
    const useAdminAuth = () => {
      const [isAdmin, setIsAdmin] = useState(false);
      const [adminRole, setAdminRole] = useState(null);
      const [permissions, setPermissions] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const checkAdmin = async () => {
          const auth = window.firebaseAuth;
          const db = window.firebaseDb;
          
          onAuthStateChanged(auth, async (user) => {
            if (!user) {
              setIsAdmin(false);
              setLoading(false);
              return;
            }

            try {
              const adminDoc = await getDoc(doc(db, 'admins', user.uid));
              
              if (adminDoc.exists()) {
                const data = adminDoc.data();
                setIsAdmin(true);
                setAdminRole(data.role);
                setPermissions(data.permissions || []);
              } else {
                setIsAdmin(false);
              }
            } catch (error) {
              console.error('ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨:', error);
              setIsAdmin(false);
            } finally {
              setLoading(false);
            }
          });
        };

        checkAdmin();
      }, []);

      const hasPermission = (permission) => {
        return permissions.includes(permission) || adminRole === 'master';
      };

      return { isAdmin, adminRole, permissions, hasPermission, loading };
    };


    // ========== StatsCard Component ==========
const StatsCard = ({ title, value, subtitle, icon, trend, onClick }) => {
  return (
    <div 
      className={`bg-white rounded-xl shadow-sm p-6 ${onClick ? 'cursor-pointer hover:shadow-md transition-shadow' : ''}`}
      onClick={onClick}
    >
      <div className="flex items-start justify-between mb-4">
        <div className="flex-1">
          <p className="text-sm text-navy-600 mb-1">{title}</p>
          <h3 className="text-3xl font-bold text-navy-900">{value}</h3>
          {subtitle && (
            <p className="text-xs text-navy-500 mt-1">{subtitle}</p>
          )}
        </div>
        {icon && (
          <div className="text-4xl opacity-50">{icon}</div>
        )}
      </div>
      {trend !== undefined && trend !== null && (
        <div className={`text-sm font-semibold flex items-center gap-1 ${
          trend > 0 ? 'text-green-600' : trend < 0 ? 'text-red-600' : 'text-navy-600'
        }`}>
          {trend > 0 ? 'â†‘' : trend < 0 ? 'â†“' : 'â†’'} 
          {trend !== 0 && `${Math.abs(trend)}%`}
          {trend === 0 && 'ë³€ë™ ì—†ìŒ'}
        </div>
      )}
    </div>
  );
};



    // ========== AdminSidebar Component ==========

const AdminSidebar = ({ currentPage, setCurrentPage }) => {
      const menuItems = [
        { page: 'dashboard', label: 'ëŒ€ì‹œë³´ë“œ', icon: 'ğŸ“Š' },
        { page: 'users', label: 'ì‚¬ìš©ì ê´€ë¦¬', icon: 'ğŸ‘¥' },
        { page: 'content', label: 'ì½˜í…ì¸  ê´€ë¦¬', icon: 'ğŸ“' },
        { page: 'crews', label: 'í¬ë£¨ ê´€ë¦¬', icon: 'ğŸ‘¥' },
        { page: 'reports', label: 'ì‹ ê³  ê´€ë¦¬', icon: 'âš ï¸' },
        { page: 'statistics', label: 'í†µê³„', icon: 'ğŸ“ˆ' },
        { page: 'settings', label: 'ì„¤ì •', icon: 'âš™ï¸' },
      ];

      return (
        <aside className="w-64 bg-white shadow-sm min-h-[calc(100vh-73px)] sticky top-[73px]">
          <nav className="p-4 space-y-2">
            {menuItems.map((item) => (
              <button
                key={item.page}
                onClick={() => setCurrentPage(item.page)}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                  currentPage === item.page
                    ? 'bg-navy-700 text-white'
                    : 'text-navy-700 hover:bg-navy-100'
                }`}
              >
                <span className="text-xl">{item.icon}</span>
                <span className="font-medium">{item.label}</span>
              </button>
            ))}
          </nav>
        </aside>
      );
    };



    // ========== AdminLayout Component ==========





    // ========== AdminRoute Component ==========

const AdminRoute = ({ children }) => {
  const { isAdmin, loading } = useAdminAuth();

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-navy-50">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">ê¶Œí•œ í™•ì¸ ì¤‘...</p>
        </div>
      </div>
    );
  }

  if (!isAdmin) {
    return <Navigate to="/" replace />;
  }

  return children;
};



    // ========== AdminDashboard Page ==========

const AdminDashboard = ({ setCurrentPage }) => {
  
  const db = window.firebaseDb;
  
  const [stats, setStats] = useState({
    totalUsers: 0,
    newUsersThisWeek: 0,
    activeUsers: 0,
    totalRuns: 0,
    totalCrews: 0,
    totalComments: 0,
    pendingReports: 0,
  });
  const [recentActivity, setRecentActivity] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadDashboardData();
  }, []);

  const loadDashboardData = async () => {
    try {
      // ì „ì²´ ì‚¬ìš©ì
      const usersSnapshot = await getDocs(collection(db, 'users'));
      const totalUsers = usersSnapshot.size;

      // ì´ë²ˆ ì£¼ ì‹ ê·œ ì‚¬ìš©ì
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      const newUsersQuery = query(
        collection(db, 'users'),
        where('createdAt', '>=', Timestamp.fromDate(weekAgo))
      );
      const newUsersSnapshot = await getDocs(newUsersQuery);
      const newUsersThisWeek = newUsersSnapshot.size;

      // í™œì„± ì‚¬ìš©ì (30ì¼ ë‚´ ê¸°ë¡ ì¶”ê°€)
      const monthAgo = new Date();
      monthAgo.setDate(monthAgo.getDate() - 30);
      const activeRunsQuery = query(
        collection(db, 'runs'),
        where('createdAt', '>=', Timestamp.fromDate(monthAgo))
      );
      const activeRunsSnapshot = await getDocs(activeRunsQuery);
      const activeUserIds = new Set(activeRunsSnapshot.docs.map(doc => doc.data().userId));
      const activeUsers = activeUserIds.size;

      // ì´ ê¸°ë¡
      const runsSnapshot = await getDocs(collection(db, 'runs'));
      const totalRuns = runsSnapshot.size;

      // ì´ í¬ë£¨ (ìˆìœ¼ë©´)
      let totalCrews = 0;
      try {
        const crewsSnapshot = await getDocs(collection(db, 'crews'));
        totalCrews = crewsSnapshot.size;
      } catch (e) {
        console.log('í¬ë£¨ ì»¬ë ‰ì…˜ ì—†ìŒ');
      }

      // ì´ ëŒ“ê¸€ (ìˆìœ¼ë©´)
      let totalComments = 0;
      try {
        const commentsSnapshot = await getDocs(collection(db, 'comments'));
        totalComments = commentsSnapshot.size;
      } catch (e) {
        console.log('ëŒ“ê¸€ ì»¬ë ‰ì…˜ ì—†ìŒ');
      }

      // ëŒ€ê¸° ì¤‘ì¸ ì‹ ê³  (ìˆìœ¼ë©´)
      let pendingReports = 0;
      try {
        const reportsQuery = query(
          collection(db, 'reports'),
          where('status', '==', 'pending')
        );
        const reportsSnapshot = await getDocs(reportsQuery);
        pendingReports = reportsSnapshot.size;
      } catch (e) {
        console.log('ì‹ ê³  ì»¬ë ‰ì…˜ ì—†ìŒ');
      }

      setStats({
        totalUsers,
        newUsersThisWeek,
        activeUsers,
        totalRuns,
        totalCrews,
        totalComments,
        pendingReports,
      });

      // ìµœê·¼ í™œë™ (ìµœê·¼ 10ê°œ ê¸°ë¡)
      const recentRunsQuery = query(
        collection(db, 'runs'),
        orderBy('createdAt', 'desc'),
        limit(10)
      );
      const recentRunsSnapshot = await getDocs(recentRunsQuery);
      const activities = [];

      for (const runDoc of recentRunsSnapshot.docs) {
        const runData = runDoc.data();
        try {
          const userDoc = await getDocs(
            query(collection(db, 'users'), where('__name__', '==', runData.userId))
          );
          const userData = userDoc.docs[0]?.data();

          activities.push({
            id: runDoc.id,
            type: 'run',
            userName: userData?.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ',
            userId: runData.userId,
            content: runData.raceName || runData.location || 'ê¸°ë¡',
            time: runData.createdAt?.toDate(),
          });
        } catch (e) {
          console.error('í™œë™ ë¡œë“œ ì‹¤íŒ¨:', e);
        }
      }

      setRecentActivity(activities);
    } catch (error) {
      console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  const formatTime = (date) => {
    if (!date) return '';
    const now = new Date();
    const diff = Math.floor((now - date) / 1000);

    if (diff < 60) return 'ë°©ê¸ˆ ì „';
    if (diff < 3600) return `${Math.floor(diff / 60)}ë¶„ ì „`;
    if (diff < 86400) return `${Math.floor(diff / 3600)}ì‹œê°„ ì „`;
    return `${Math.floor(diff / 86400)}ì¼ ì „`;
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">ë°ì´í„° ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-bold text-navy-900">ëŒ€ì‹œë³´ë“œ</h2>
        <p className="text-navy-600 mt-1">RunLog ì „ì²´ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</p>
      </div>

      {/* í†µê³„ ì¹´ë“œ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <StatsCard
          title="ì „ì²´ ì‚¬ìš©ì"
          value={stats.totalUsers.toLocaleString()}
          icon="ğŸ‘¥"
          onClick={() => window.location.href = '/admin.html'}
        />
        <StatsCard
          title="ì‹ ê·œ ì‚¬ìš©ì"
          value={stats.newUsersThisWeek.toLocaleString()}
          subtitle="ì´ë²ˆ ì£¼"
          icon="âœ¨"
        />
        <StatsCard
          title="í™œì„± ì‚¬ìš©ì"
          value={stats.activeUsers.toLocaleString()}
          subtitle="ìµœê·¼ 30ì¼"
          icon="ğŸ”¥"
        />
        <StatsCard
          title="ì´ ê¸°ë¡"
          value={stats.totalRuns.toLocaleString()}
          icon="ğŸƒ"
        />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <StatsCard
          title="ì´ í¬ë£¨"
          value={stats.totalCrews.toLocaleString()}
          icon="ğŸ‘¥"
        />
        <StatsCard
          title="ì´ ëŒ“ê¸€"
          value={stats.totalComments.toLocaleString()}
          icon="ğŸ’¬"
        />
        <StatsCard
          title="ëŒ€ê¸° ì¤‘ì¸ ì‹ ê³ "
          value={stats.pendingReports.toLocaleString()}
          icon="âš ï¸"
        />
      </div>

      {/* ìµœê·¼ í™œë™ */}
      <div className="bg-white rounded-xl shadow-sm p-6">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold text-navy-900">ìµœê·¼ í™œë™</h3>
          <button
            onClick={() => setCurrentPage('content')}
            className="text-sm text-navy-600 hover:text-navy-900"
          >
            ì „ì²´ ë³´ê¸° â†’
          </button>
        </div>
        <div className="space-y-3">
          {recentActivity.length === 0 ? (
            <p className="text-navy-500 text-center py-8">í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</p>
          ) : (
            recentActivity.map((activity) => (
              <div
                key={activity.id}
                className="flex items-center justify-between py-3 border-b border-navy-100 last:border-0 hover:bg-navy-50 px-2 rounded transition-colors"
              >
                <div className="flex-1">
                  <p className="text-sm text-navy-900">
                    <span className="font-semibold">{activity.userName}</span>
                    <span className="text-navy-600"> ë‹˜ì´ </span>
                    <span className="font-medium">{activity.content}</span>
                    <span className="text-navy-600"> ê¸°ë¡ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤</span>
                  </p>
                </div>
                <span className="text-xs text-navy-400 ml-4">
                  {formatTime(activity.time)}
                </span>
              </div>
            ))
          )}
        </div>
      </div>
    </div>
  );
};



    // ========== UserManagement Page ==========

const UserManagement = ({ setCurrentPage, setSelectedUserId }) => {
  
  const db = window.firebaseDb;
  
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all'); // all, active, suspended

  useEffect(() => {
    loadUsers();
  }, []);

  const loadUsers = async () => {
    try {
      const usersQuery = query(
        collection(db, 'users'),
        orderBy('createdAt', 'desc')
      );
      const snapshot = await getDocs(usersQuery);
      const usersData = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      setUsers(usersData);
    } catch (error) {
      console.error('ì‚¬ìš©ì ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  const handleSuspendUser = async (userId, suspend) => {
    const action = suspend ? 'ì •ì§€' : 'ì •ì§€ í•´ì œ';
    if (!confirm(`ì´ ì‚¬ìš©ìë¥¼ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      return;
    }

    try {
      await updateDoc(doc(db, 'users', userId), {
        suspended: suspend,
        suspendedAt: suspend ? Timestamp.now() : null
      });
      
      alert(`ì‚¬ìš©ìê°€ ${action}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      loadUsers();
    } catch (error) {
      console.error('ì‚¬ìš©ì ì •ì§€ ì‹¤íŒ¨:', error);
      alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const filteredUsers = users.filter(user => {
    // ê²€ìƒ‰ í•„í„°
    const matchesSearch = 
      user.nickname?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      user.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      user.id.toLowerCase().includes(searchTerm.toLowerCase());
    
    if (!matchesSearch) return false;

    // ìƒíƒœ í•„í„°
    if (filterStatus === 'active') return !user.suspended;
    if (filterStatus === 'suspended') return user.suspended;
    return true; // all
  });

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">ì‚¬ìš©ì ëª©ë¡ ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold text-navy-900">ì‚¬ìš©ì ê´€ë¦¬</h2>
          <p className="text-navy-600 mt-1">ì „ì²´ {users.length.toLocaleString()}ëª…</p>
        </div>
      </div>

      {/* ê²€ìƒ‰ & í•„í„° */}
      <div className="bg-white rounded-xl shadow-sm p-4">
        <div className="flex gap-4">
          <input
            type="text"
            placeholder="ë‹‰ë„¤ì„, ì´ë©”ì¼ ë˜ëŠ” IDë¡œ ê²€ìƒ‰..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="flex-1 px-4 py-2 border-2 border-navy-200 rounded-lg focus:border-navy-600 focus:outline-none"
          />
          <select
            value={filterStatus}
            onChange={(e) => setFilterStatus(e.target.value)}
            className="px-4 py-2 border-2 border-navy-200 rounded-lg focus:border-navy-600 focus:outline-none bg-white"
          >
            <option value="all">ì „ì²´</option>
            <option value="active">ì •ìƒ</option>
            <option value="suspended">ì •ì§€ë¨</option>
          </select>
        </div>
      </div>

      {/* ì‚¬ìš©ì í…Œì´ë¸” */}
      <div className="bg-white rounded-xl shadow-sm overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-navy-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase tracking-wider">
                  ID
                </th>
                <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase tracking-wider">
                  ë‹‰ë„¤ì„
                </th>
                <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase tracking-wider">
                  ì´ë©”ì¼
                </th>
                <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase tracking-wider">
                  ê°€ì…ì¼
                </th>
                <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase tracking-wider">
                  ìƒíƒœ
                </th>
                <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase tracking-wider">
                  ì‘ì—…
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-navy-100">
              {filteredUsers.map((user) => (
                <tr key={user.id} className="hover:bg-navy-50 transition-colors">
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-navy-500">
                    #{user.id.slice(0, 8)}...
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="flex items-center gap-2">
                      {user.photoURL ? (
                        <img 
                          src={user.photoURL} 
                          alt={user.nickname}
                          className="w-8 h-8 rounded-full"
                        />
                      ) : (
                        <div className="w-8 h-8 rounded-full bg-navy-200 flex items-center justify-center text-navy-600 text-xs font-bold">
                          {user.nickname?.[0]?.toUpperCase() || '?'}
                        </div>
                      )}
                      <span className="text-sm font-medium text-navy-900">
                        {user.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                      </span>
                    </div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-navy-500">
                    {user.email}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-navy-500">
                    {user.createdAt?.toDate ? 
                      user.createdAt.toDate().toLocaleDateString('ko-KR') :
                      '-'
                    }
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    {user.suspended ? (
                      <span className="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-600">
                        ì •ì§€ë¨
                      </span>
                    ) : (
                      <span className="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-600">
                        ì •ìƒ
                      </span>
                    )}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                    <button
                      onClick={() => {
                        setCurrentPage('user-detail');
                        setSelectedUserId(user.id);
                      }}
                      className="px-3 py-1 bg-navy-100 text-navy-700 rounded hover:bg-navy-200 transition-colors font-medium"
                    >
                      ìƒì„¸
                    </button>
                    <button
                      onClick={() => handleSuspendUser(user.id, !user.suspended)}
                      className={`px-3 py-1 rounded transition-colors font-medium ${
                        user.suspended
                          ? 'bg-green-100 text-green-700 hover:bg-green-200'
                          : 'bg-red-100 text-red-700 hover:bg-red-200'
                      }`}
                    >
                      {user.suspended ? 'í•´ì œ' : 'ì •ì§€'}
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>

          {filteredUsers.length === 0 && (
            <div className="text-center text-navy-500 py-12">
              <p className="text-lg font-medium mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
              <p className="text-sm">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};



    // ========== UserDetail Page ==========

const UserDetail = ({ selectedUserId, setCurrentPage }) => {
  const id = new URLSearchParams(window.location.search).get('id') || selectedUserId;
  
  const db = window.firebaseDb;
  
  const [user, setUser] = useState(null);
  const [stats, setStats] = useState({
    totalRuns: 0,
    raceRuns: 0,
    casualRuns: 0,
    friends: 0,
    crews: 0,
    likes: 0,
    comments: 0,
  });
  const [recentRuns, setRecentRuns] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadUserDetail();
  }, [id]);

  const loadUserDetail = async () => {
    try {
      // ì‚¬ìš©ì ì •ë³´
      const userDoc = await getDoc(doc(db, 'users', id));
      if (!userDoc.exists()) {
        alert('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        setCurrentPage('users');
        return;
      }
      setUser({ id: userDoc.id, ...userDoc.data() });

      // ëŸ¬ë‹ ê¸°ë¡ í†µê³„
      const runsQuery = query(collection(db, 'runs'), where('userId', '==', id));
      const runsSnapshot = await getDocs(runsQuery);
      const runs = runsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

      // ìµœê·¼ 5ê°œ ê¸°ë¡
      const sortedRuns = runs
        .sort((a, b) => (b.createdAt?.toDate?.() || 0) - (a.createdAt?.toDate?.() || 0))
        .slice(0, 5);
      setRecentRuns(sortedRuns);

      // ì¹œêµ¬ ìˆ˜
      let friendsCount = 0;
      try {
        const friendsQuery = query(collection(db, 'friends'), where('userId', '==', id));
        const friendsSnapshot = await getDocs(friendsQuery);
        friendsCount = friendsSnapshot.size;
      } catch (e) {
        console.log('ì¹œêµ¬ ì»¬ë ‰ì…˜ ì—†ìŒ');
      }

      // í¬ë£¨ ìˆ˜
      let crewsCount = 0;
      try {
        const crewMembersQuery = query(collection(db, 'crewMembers'), where('userId', '==', id));
        const crewMembersSnapshot = await getDocs(crewMembersQuery);
        crewsCount = crewMembersSnapshot.size;
      } catch (e) {
        console.log('í¬ë£¨ ì»¬ë ‰ì…˜ ì—†ìŒ');
      }

      // ì¢‹ì•„ìš”/ëŒ“ê¸€ ìˆ˜
      let likesCount = 0;
      let commentsCount = 0;
      try {
        const likesQuery = query(collection(db, 'likes'), where('userId', '==', id));
        const likesSnapshot = await getDocs(likesQuery);
        likesCount = likesSnapshot.size;

        const commentsQuery = query(collection(db, 'comments'), where('userId', '==', id));
        const commentsSnapshot = await getDocs(commentsQuery);
        commentsCount = commentsSnapshot.size;
      } catch (e) {
        console.log('ì¢‹ì•„ìš”/ëŒ“ê¸€ ì»¬ë ‰ì…˜ ì—†ìŒ');
      }

      setStats({
        totalRuns: runs.length,
        raceRuns: runs.filter(r => r.runType === 'race').length,
        casualRuns: runs.filter(r => r.runType === 'casual').length,
        friends: friendsCount,
        crews: crewsCount,
        likes: likesCount,
        comments: commentsCount,
      });
    } catch (error) {
      console.error('ì‚¬ìš©ì ìƒì„¸ ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  const formatTime = (seconds) => {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    if (h > 0) {
      return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }
    return `${m}:${s.toString().padStart(2, '0')}`;
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">ì‚¬ìš©ì ì •ë³´ ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  if (!user) return null;

  return (
    <div className="space-y-6">
      <div className="flex items-center gap-4">
        <button
          onClick={() => setCurrentPage('users')}
          className="px-4 py-2 bg-navy-100 text-navy-700 rounded-lg hover:bg-navy-200 transition-colors font-medium"
        >
          â† ë’¤ë¡œ
        </button>
        <div>
          <h2 className="text-2xl font-bold text-navy-900">
            ì‚¬ìš©ì ìƒì„¸
          </h2>
          <p className="text-navy-600 mt-1">#{user.id.slice(0, 8)}...</p>
        </div>
      </div>

      {/* ê¸°ë³¸ ì •ë³´ */}
      <div className="bg-white rounded-xl shadow-sm p-6">
        <h3 className="text-lg font-bold text-navy-900 mb-4">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
        <div className="flex items-start gap-6">
          {user.photoURL ? (
            <img 
              src={user.photoURL} 
              alt={user.nickname}
              className="w-24 h-24 rounded-full"
            />
          ) : (
            <div className="w-24 h-24 rounded-full bg-navy-200 flex items-center justify-center text-navy-600 text-3xl font-bold">
              {user.nickname?.[0]?.toUpperCase() || '?'}
            </div>
          )}
          <div className="flex-1 grid grid-cols-2 gap-4">
            <div>
              <p className="text-sm text-navy-600">ë‹‰ë„¤ì„</p>
              <p className="text-base font-medium text-navy-900">{user.nickname || '-'}</p>
            </div>
            <div>
              <p className="text-sm text-navy-600">ì´ë©”ì¼</p>
              <p className="text-base font-medium text-navy-900">{user.email}</p>
            </div>
            <div>
              <p className="text-sm text-navy-600">ê°€ì…ì¼</p>
              <p className="text-base font-medium text-navy-900">
                {user.createdAt?.toDate ? 
                  user.createdAt.toDate().toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  }) : '-'
                }
              </p>
            </div>
            <div>
              <p className="text-sm text-navy-600">ìƒíƒœ</p>
              <p className="text-base font-medium text-navy-900">
                {user.suspended ? (
                  <span className="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-600">
                    ì •ì§€ë¨
                  </span>
                ) : (
                  <span className="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-600">
                    ì •ìƒ
                  </span>
                )}
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* í™œë™ í†µê³„ */}
      <div className="bg-white rounded-xl shadow-sm p-6">
        <h3 className="text-lg font-bold text-navy-900 mb-4">ğŸ“Š í™œë™ í†µê³„</h3>
        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
          <div className="text-center">
            <p className="text-2xl font-bold text-navy-900">{stats.totalRuns}</p>
            <p className="text-sm text-navy-600">ì´ ê¸°ë¡</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-navy-900">{stats.raceRuns}</p>
            <p className="text-sm text-navy-600">ëŒ€íšŒ ê¸°ë¡</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-navy-900">{stats.casualRuns}</p>
            <p className="text-sm text-navy-600">ì¼ìƒ ê¸°ë¡</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-navy-900">{stats.friends}</p>
            <p className="text-sm text-navy-600">ì¹œêµ¬</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-navy-900">{stats.crews}</p>
            <p className="text-sm text-navy-600">í¬ë£¨</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-navy-900">{stats.likes}</p>
            <p className="text-sm text-navy-600">ì¢‹ì•„ìš”</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-navy-900">{stats.comments}</p>
            <p className="text-sm text-navy-600">ëŒ“ê¸€</p>
          </div>
        </div>
      </div>

      {/* ìµœê·¼ ê¸°ë¡ */}
      <div className="bg-white rounded-xl shadow-sm p-6">
        <h3 className="text-lg font-bold text-navy-900 mb-4">ğŸƒ ìµœê·¼ ê¸°ë¡ (5ê°œ)</h3>
        {recentRuns.length === 0 ? (
          <p className="text-navy-500 text-center py-8">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
        ) : (
          <div className="space-y-3">
            {recentRuns.map((run) => (
              <div key={run.id} className="flex items-center justify-between p-3 border border-navy-100 rounded-lg hover:bg-navy-50 transition-colors">
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-1">
                    <span className="px-2 py-0.5 text-xs font-semibold rounded bg-navy-100 text-navy-700">
                      {run.runType === 'race' ? 'ëŒ€íšŒ' : 'ì¼ìƒ'}
                    </span>
                    <p className="text-sm font-medium text-navy-900">
                      {run.raceName || run.location || 'ê¸°ë¡'}
                    </p>
                  </div>
                  <div className="flex items-center gap-3 text-xs text-navy-600">
                    <span>{run.distance}km</span>
                    <span>â€¢</span>
                    <span>{formatTime(run.time)}</span>
                    <span>â€¢</span>
                    <span>
                      {run.createdAt?.toDate ? 
                        run.createdAt.toDate().toLocaleDateString('ko-KR') : 
                        '-'
                      }
                    </span>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
};



    // ========== ContentManagement Page ==========

const ContentManagement = () => {
  const db = window.firebaseDb;
  
  const [runs, setRuns] = useState([]);
  const [loading, setLoading] = useState(true);
  const [filterType, setFilterType] = useState('all'); // all, race, casual

  useEffect(() => {
    loadRuns();
  }, []);

  const loadRuns = async () => {
    try {
      const runsQuery = query(
        collection(db, 'runs'),
        orderBy('createdAt', 'desc'),
        limit(100) // ìµœê·¼ 100ê°œë§Œ
      );
      const snapshot = await getDocs(runsQuery);
      
      // ì‚¬ìš©ì ì •ë³´ë„ í•¨ê»˜ ë¡œë“œ
      const runsWithUsers = await Promise.all(
        snapshot.docs.map(async (runDoc) => {
          const runData = runDoc.data();
          try {
            const userDoc = await getDocs(
              query(collection(db, 'users'), where('__name__', '==', runData.userId))
            );
            const userData = userDoc.docs[0]?.data();
            
            return {
              id: runDoc.id,
              ...runData,
              userName: userData?.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ',
            };
          } catch (e) {
            return {
              id: runDoc.id,
              ...runData,
              userName: 'ì•Œ ìˆ˜ ì—†ìŒ',
            };
          }
        })
      );
      
      setRuns(runsWithUsers);
    } catch (error) {
      console.error('ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleDeleteRun = async (runId) => {
    if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
      return;
    }

    try {
      await deleteDoc(doc(db, 'runs', runId));
      alert('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      loadRuns();
    } catch (error) {
      console.error('ê¸°ë¡ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ê¸°ë¡ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const formatTime = (seconds) => {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    if (h > 0) {
      return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }
    return `${m}:${s.toString().padStart(2, '0')}`;
  };

  const filteredRuns = runs.filter(run => {
    if (filterType === 'race') return run.runType === 'race';
    if (filterType === 'casual') return run.runType === 'casual';
    return true;
  });

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">ì½˜í…ì¸  ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-bold text-navy-900">ì½˜í…ì¸  ê´€ë¦¬</h2>
        <p className="text-navy-600 mt-1">ëŸ¬ë‹ ê¸°ë¡ ê´€ë¦¬</p>
      </div>

      {/* í•„í„° */}
      <div className="bg-white rounded-xl shadow-sm p-4">
        <div className="flex gap-2">
          <button
            onClick={() => setFilterType('all')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterType === 'all'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ì „ì²´ ({runs.length})
          </button>
          <button
            onClick={() => setFilterType('race')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterType === 'race'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ëŒ€íšŒ ({runs.filter(r => r.runType === 'race').length})
          </button>
          <button
            onClick={() => setFilterType('casual')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterType === 'casual'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ì¼ìƒ ({runs.filter(r => r.runType === 'casual').length})
          </button>
        </div>
      </div>

      {/* ê¸°ë¡ ê·¸ë¦¬ë“œ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {filteredRuns.map((run) => (
          <div key={run.id} className="bg-white rounded-xl shadow-sm overflow-hidden">
            {/* ì¸ë„¤ì¼ */}
            {run.photos && run.photos.length > 0 ? (
              <div className="relative aspect-square bg-navy-100">
                <img
                  src={run.photos[0]}
                  alt="Run"
                  className="w-full h-full object-cover"
                />
              </div>
            ) : (
              <div className="aspect-square bg-gradient-to-br from-navy-700 to-navy-900 flex items-center justify-center">
                <span className="text-white text-4xl">ğŸƒ</span>
              </div>
            )}

            {/* ì •ë³´ */}
            <div className="p-4">
              <div className="flex items-center gap-2 mb-2">
                <span className={`px-2 py-0.5 text-xs font-semibold rounded ${
                  run.runType === 'race' 
                    ? 'bg-yellow-100 text-yellow-700' 
                    : 'bg-blue-100 text-blue-700'
                }`}>
                  {run.runType === 'race' ? 'ëŒ€íšŒ' : 'ì¼ìƒ'}
                </span>
                {run.isPublic === false && (
                  <span className="px-2 py-0.5 text-xs font-semibold rounded bg-gray-100 text-gray-700">
                    ë¹„ê³µê°œ
                  </span>
                )}
              </div>

              <h3 className="font-bold text-navy-900 mb-1 truncate">
                {run.raceName || run.location || 'ê¸°ë¡'}
              </h3>

              <div className="flex items-center gap-2 text-sm text-navy-600 mb-2">
                <span>{run.distance}km</span>
                <span>â€¢</span>
                <span>{formatTime(run.time)}</span>
              </div>

              <p className="text-xs text-navy-500 mb-3">
                {run.userName} â€¢ {run.createdAt?.toDate ? 
                  run.createdAt.toDate().toLocaleDateString('ko-KR') : 
                  '-'
                }
              </p>

              {run.memo && (
                <p className="text-sm text-navy-700 mb-3 line-clamp-2">
                  {run.memo}
                </p>
              )}

              <button
                onClick={() => handleDeleteRun(run.id)}
                className="w-full px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium"
              >
                ì‚­ì œ
              </button>
            </div>
          </div>
        ))}
      </div>

      {filteredRuns.length === 0 && (
        <div className="bg-white rounded-xl shadow-sm p-12 text-center">
          <p className="text-lg font-medium text-navy-900 mb-2">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
          <p className="text-sm text-navy-600">í•„í„°ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”</p>
        </div>
      )}
    </div>
  );
};



    // ========== CrewManagement Page ==========

const CrewManagement = () => {
  
  const db = window.firebaseDb;
  
  const [crews, setCrews] = useState([]);
  const [loading, setLoading] = useState(true);
  const [filterStatus, setFilterStatus] = useState('all'); // all, pending, active

  useEffect(() => {
    loadCrews();
  }, []);

  const loadCrews = async () => {
    try {
      const crewsQuery = query(
        collection(db, 'crews'),
        orderBy('createdAt', 'desc')
      );
      const snapshot = await getDocs(crewsQuery);
      
      // ë©¤ë²„ ìˆ˜ ê³„ì‚°
      const crewsWithMembers = await Promise.all(
        snapshot.docs.map(async (crewDoc) => {
          const crewData = crewDoc.data();
          
          // ë©¤ë²„ ìˆ˜ ê³„ì‚°
          let memberCount = 0;
          try {
            const membersQuery = query(
              collection(db, 'crewMembers'),
              where('crewId', '==', crewDoc.id)
            );
            const membersSnapshot = await getDocs(membersQuery);
            memberCount = membersSnapshot.size;
          } catch (e) {
            console.log('ë©¤ë²„ ì¡°íšŒ ì‹¤íŒ¨');
          }

          // ê´€ë¦¬ì ì •ë³´
          let ownerName = 'ì•Œ ìˆ˜ ì—†ìŒ';
          try {
            const ownerDoc = await getDocs(
              query(collection(db, 'users'), where('__name__', '==', crewData.ownerId))
            );
            ownerName = ownerDoc.docs[0]?.data()?.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ';
          } catch (e) {
            console.log('ê´€ë¦¬ì ì¡°íšŒ ì‹¤íŒ¨');
          }

          return {
            id: crewDoc.id,
            ...crewData,
            memberCount,
            ownerName,
          };
        })
      );
      
      setCrews(crewsWithMembers);
    } catch (error) {
      console.error('í¬ë£¨ ë¡œë“œ ì‹¤íŒ¨:', error);
      // í¬ë£¨ ì»¬ë ‰ì…˜ì´ ì—†ì„ ìˆ˜ ìˆìŒ
      setCrews([]);
    } finally {
      setLoading(false);
    }
  };

  const handleApproveCrew = async (crewId, approve) => {
    const action = approve ? 'ìŠ¹ì¸' : 'ê±°ë¶€';
    if (!confirm(`ì´ í¬ë£¨ë¥¼ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      return;
    }

    try {
      if (approve) {
        await updateDoc(doc(db, 'crews', crewId), {
          status: 'approved',
          approvedAt: new Date()
        });
        alert('í¬ë£¨ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else {
        await deleteDoc(doc(db, 'crews', crewId));
        alert('í¬ë£¨ê°€ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
      loadCrews();
    } catch (error) {
      console.error('í¬ë£¨ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleDeleteCrew = async (crewId) => {
    if (!confirm('ì´ í¬ë£¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
      return;
    }

    try {
      await deleteDoc(doc(db, 'crews', crewId));
      
      // í¬ë£¨ ë©¤ë²„ë„ ì‚­ì œ
      const membersQuery = query(
        collection(db, 'crewMembers'),
        where('crewId', '==', crewId)
      );
      const membersSnapshot = await getDocs(membersQuery);
      await Promise.all(
        membersSnapshot.docs.map(doc => deleteDoc(doc.ref))
      );
      
      alert('í¬ë£¨ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      loadCrews();
    } catch (error) {
      console.error('í¬ë£¨ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('í¬ë£¨ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const filteredCrews = crews.filter(crew => {
    if (filterStatus === 'pending') return crew.status === 'pending';
    if (filterStatus === 'active') return crew.status !== 'pending';
    return true;
  });

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">í¬ë£¨ ëª©ë¡ ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-bold text-navy-900">í¬ë£¨ ê´€ë¦¬</h2>
        <p className="text-navy-600 mt-1">ì „ì²´ {crews.length}ê°œ</p>
      </div>

      {/* í•„í„° */}
      <div className="bg-white rounded-xl shadow-sm p-4">
        <div className="flex gap-2">
          <button
            onClick={() => setFilterStatus('all')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'all'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ì „ì²´ ({crews.length})
          </button>
          <button
            onClick={() => setFilterStatus('pending')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'pending'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ìŠ¹ì¸ ëŒ€ê¸° ({crews.filter(c => c.status === 'pending').length})
          </button>
          <button
            onClick={() => setFilterStatus('active')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'active'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            í™œì„± ({crews.filter(c => c.status !== 'pending').length})
          </button>
        </div>
      </div>

      {/* í¬ë£¨ ëª©ë¡ */}
      <div className="space-y-4">
        {filteredCrews.length === 0 ? (
          <div className="bg-white rounded-xl shadow-sm p-12 text-center">
            <p className="text-lg font-medium text-navy-900 mb-2">í¬ë£¨ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            <p className="text-sm text-navy-600">
              {crews.length === 0 
                ? 'ì•„ì§ ìƒì„±ëœ í¬ë£¨ê°€ ì—†ìŠµë‹ˆë‹¤' 
                : 'í•„í„°ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”'
              }
            </p>
          </div>
        ) : (
          filteredCrews.map((crew) => (
            <div key={crew.id} className="bg-white rounded-xl shadow-sm p-6">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <h3 className="text-lg font-bold text-navy-900">
                      {crew.name}
                    </h3>
                    {crew.status === 'pending' && (
                      <span className="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-700">
                        ìŠ¹ì¸ ëŒ€ê¸°
                      </span>
                    )}
                    {crew.isPublic && (
                      <span className="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-700">
                        ê³µê°œ
                      </span>
                    )}
                  </div>

                  <p className="text-sm text-navy-600 mb-3">
                    {crew.description || 'ì„¤ëª… ì—†ìŒ'}
                  </p>

                  <div className="flex items-center gap-4 text-sm text-navy-500">
                    <span>ğŸ‘¥ {crew.memberCount}ëª…</span>
                    <span>â€¢</span>
                    <span>ğŸ‘¤ ê´€ë¦¬ì: {crew.ownerName}</span>
                    <span>â€¢</span>
                    <span>
                      ìƒì„±ì¼: {crew.createdAt?.toDate ? 
                        crew.createdAt.toDate().toLocaleDateString('ko-KR') : 
                        '-'
                      }
                    </span>
                  </div>

                  {crew.location && (
                    <p className="text-xs text-navy-400 mt-2">
                      ğŸ“ {crew.location}
                    </p>
                  )}
                </div>

                <div className="flex gap-2 ml-4">
                  {crew.status === 'pending' ? (
                    <>
                      <button
                        onClick={() => handleApproveCrew(crew.id, true)}
                        className="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors font-medium text-sm"
                      >
                        ìŠ¹ì¸
                      </button>
                      <button
                        onClick={() => handleApproveCrew(crew.id, false)}
                        className="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium text-sm"
                      >
                        ê±°ë¶€
                      </button>
                    </>
                  ) : (
                    <button
                      onClick={() => handleDeleteCrew(crew.id)}
                      className="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium text-sm"
                    >
                      ì‚­ì œ
                    </button>
                  )}
                </div>
              </div>
            </div>
          ))
        )}
      </div>
    </div>
  );
};



    // ========== ReportManagement Page ==========

const ReportManagement = () => {
  const db = window.firebaseDb;
  const auth = window.firebaseAuth;
  
  const [reports, setReports] = useState([]);
  const [loading, setLoading] = useState(true);
  const [filterStatus, setFilterStatus] = useState('pending'); // pending, processing, resolved, dismissed
  const [selectedReport, setSelectedReport] = useState(null);

  useEffect(() => {
    loadReports();
  }, []);

  const loadReports = async () => {
    try {
      const reportsQuery = query(
        collection(db, 'reports'),
        orderBy('createdAt', 'desc')
      );
      const snapshot = await getDocs(reportsQuery);
      
      // ì‚¬ìš©ì ì •ë³´ ì¶”ê°€
      const reportsWithUsers = await Promise.all(
        snapshot.docs.map(async (reportDoc) => {
          const reportData = reportDoc.data();
          
          // ì‹ ê³ ì ì •ë³´
          let reporterName = 'ì•Œ ìˆ˜ ì—†ìŒ';
          try {
            const reporterDoc = await getDocs(
              query(collection(db, 'users'), where('__name__', '==', reportData.reporterId))
            );
            reporterName = reporterDoc.docs[0]?.data()?.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ';
          } catch (e) {}

          // ëŒ€ìƒ ì‚¬ìš©ì ì •ë³´
          let targetUserName = 'ì•Œ ìˆ˜ ì—†ìŒ';
          try {
            const targetUserDoc = await getDocs(
              query(collection(db, 'users'), where('__name__', '==', reportData.targetUserId))
            );
            targetUserName = targetUserDoc.docs[0]?.data()?.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ';
          } catch (e) {}

          return {
            id: reportDoc.id,
            ...reportData,
            reporterName,
            targetUserName,
          };
        })
      );
      
      setReports(reportsWithUsers);
    } catch (error) {
      console.error('ì‹ ê³  ë¡œë“œ ì‹¤íŒ¨:', error);
      setReports([]);
    } finally {
      setLoading(false);
    }
  };

  const handleUpdateStatus = async (reportId, status, action) => {
    if (!confirm(`ì´ ì‹ ê³ ë¥¼ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      return;
    }

    try {
      await updateDoc(doc(db, 'reports', reportId), {
        status,
        resolvedAt: Timestamp.now(),
        resolvedBy: auth.currentUser?.uid || 'unknown'
      });
      
      alert(`ì‹ ê³ ê°€ ${action}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      setSelectedReport(null);
      loadReports();
    } catch (error) {
      console.error('ì‹ ê³  ì²˜ë¦¬ ì‹¤íŒ¨:', error);
      alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleDeleteContent = async (report) => {
    if (!confirm('ì‹ ê³ ëœ ì½˜í…ì¸ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      return;
    }

    try {
      // ì½˜í…ì¸  ì‚­ì œ
      if (report.type === 'run') {
        await deleteDoc(doc(db, 'runs', report.targetId));
      } else if (report.type === 'comment') {
        await deleteDoc(doc(db, 'comments', report.targetId));
      } else if (report.type === 'post') {
        await deleteDoc(doc(db, 'crewPosts', report.targetId));
      }

      // ì‹ ê³  ìƒíƒœ ì—…ë°ì´íŠ¸
      await updateDoc(doc(db, 'reports', report.id), {
        status: 'resolved',
        resolvedAt: Timestamp.now(),
        resolvedBy: auth.currentUser?.uid || 'unknown',
        adminNote: 'ì½˜í…ì¸  ì‚­ì œë¨'
      });

      alert('ì½˜í…ì¸ ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      setSelectedReport(null);
      loadReports();
    } catch (error) {
      console.error('ì½˜í…ì¸  ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ì½˜í…ì¸  ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const getCategoryLabel = (category) => {
    const labels = {
      spam: 'ìŠ¤íŒ¸',
      inappropriate: 'ë¶€ì ì ˆí•œ ë‚´ìš©',
      harassment: 'ê´´ë¡­í˜',
      other: 'ê¸°íƒ€'
    };
    return labels[category] || category;
  };

  const getTypeLabel = (type) => {
    const labels = {
      run: 'ëŸ¬ë‹ ê¸°ë¡',
      comment: 'ëŒ“ê¸€',
      post: 'ê²Œì‹œê¸€',
      user: 'ì‚¬ìš©ì'
    };
    return labels[type] || type;
  };

  const filteredReports = reports.filter(report => {
    if (filterStatus === 'all') return true;
    return report.status === filterStatus;
  });

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">ì‹ ê³  ëª©ë¡ ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-bold text-navy-900">ì‹ ê³  ê´€ë¦¬</h2>
        <p className="text-navy-600 mt-1">ì „ì²´ {reports.length}ê±´</p>
      </div>

      {/* í•„í„° */}
      <div className="bg-white rounded-xl shadow-sm p-4">
        <div className="flex gap-2 flex-wrap">
          <button
            onClick={() => setFilterStatus('all')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'all'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ì „ì²´ ({reports.length})
          </button>
          <button
            onClick={() => setFilterStatus('pending')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'pending'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ë¯¸ì²˜ë¦¬ ({reports.filter(r => r.status === 'pending').length})
          </button>
          <button
            onClick={() => setFilterStatus('processing')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'processing'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ì²˜ë¦¬ì¤‘ ({reports.filter(r => r.status === 'processing').length})
          </button>
          <button
            onClick={() => setFilterStatus('resolved')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'resolved'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ì™„ë£Œ ({reports.filter(r => r.status === 'resolved').length})
          </button>
          <button
            onClick={() => setFilterStatus('dismissed')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              filterStatus === 'dismissed'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ë¬´ì‹œë¨ ({reports.filter(r => r.status === 'dismissed').length})
          </button>
        </div>
      </div>

      {/* ì‹ ê³  ëª©ë¡ */}
      <div className="bg-white rounded-xl shadow-sm overflow-hidden">
        <table className="w-full">
          <thead className="bg-navy-50">
            <tr>
              <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase">ìœ í˜•</th>
              <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase">ì¹´í…Œê³ ë¦¬</th>
              <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase">ëŒ€ìƒ</th>
              <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase">ì‹ ê³ ì</th>
              <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase">ì¼ì‹œ</th>
              <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase">ìƒíƒœ</th>
              <th className="px-6 py-3 text-left text-xs font-semibold text-navy-700 uppercase">ì‘ì—…</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-navy-100">
            {filteredReports.map((report) => (
              <tr key={report.id} className="hover:bg-navy-50">
                <td className="px-6 py-4 text-sm text-navy-900">
                  {getTypeLabel(report.type)}
                </td>
                <td className="px-6 py-4 text-sm">
                  <span className="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700">
                    {getCategoryLabel(report.category)}
                  </span>
                </td>
                <td className="px-6 py-4 text-sm text-navy-600">
                  {report.targetUserName}
                </td>
                <td className="px-6 py-4 text-sm text-navy-600">
                  {report.reporterName}
                </td>
                <td className="px-6 py-4 text-sm text-navy-500">
                  {report.createdAt?.toDate ? 
                    report.createdAt.toDate().toLocaleDateString('ko-KR') : 
                    '-'
                  }
                </td>
                <td className="px-6 py-4">
                  {report.status === 'pending' && (
                    <span className="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-700">
                      ë¯¸ì²˜ë¦¬
                    </span>
                  )}
                  {report.status === 'processing' && (
                    <span className="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-700">
                      ì²˜ë¦¬ì¤‘
                    </span>
                  )}
                  {report.status === 'resolved' && (
                    <span className="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700">
                      ì™„ë£Œ
                    </span>
                  )}
                  {report.status === 'dismissed' && (
                    <span className="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-700">
                      ë¬´ì‹œë¨
                    </span>
                  )}
                </td>
                <td className="px-6 py-4 text-sm">
                  <button
                    onClick={() => setSelectedReport(report)}
                    className="px-3 py-1 bg-navy-100 text-navy-700 rounded hover:bg-navy-200 transition-colors font-medium"
                  >
                    ìƒì„¸
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>

        {filteredReports.length === 0 && (
          <div className="text-center text-navy-500 py-12">
            <p className="text-lg font-medium mb-2">ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            <p className="text-sm">
              {reports.length === 0 
                ? 'ì•„ì§ ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤' 
                : 'í•„í„°ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”'
              }
            </p>
          </div>
        )}
      </div>

      {/* ì‹ ê³  ìƒì„¸ ëª¨ë‹¬ */}
      {selectedReport && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-navy-100">
              <div className="flex items-center justify-between">
                <h3 className="text-xl font-bold text-navy-900">ì‹ ê³  ìƒì„¸</h3>
                <button
                  onClick={() => setSelectedReport(null)}
                  className="text-navy-400 hover:text-navy-600"
                >
                  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            </div>

            <div className="p-6 space-y-4">
              {/* ì‹ ê³  ì •ë³´ */}
              <div>
                <h4 className="font-semibold text-navy-900 mb-2">ğŸ“‹ ì‹ ê³  ì •ë³´</h4>
                <div className="bg-navy-50 rounded-lg p-4 space-y-2">
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-navy-600 w-24">ìœ í˜•:</span>
                    <span className="text-sm font-medium text-navy-900">
                      {getTypeLabel(selectedReport.type)}
                    </span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-navy-600 w-24">ì¹´í…Œê³ ë¦¬:</span>
                    <span className="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700">
                      {getCategoryLabel(selectedReport.category)}
                    </span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-navy-600 w-24">ì‹ ê³ ì:</span>
                    <span className="text-sm font-medium text-navy-900">
                      {selectedReport.reporterName}
                    </span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-navy-600 w-24">ëŒ€ìƒ ì‚¬ìš©ì:</span>
                    <span className="text-sm font-medium text-navy-900">
                      {selectedReport.targetUserName}
                    </span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-navy-600 w-24">ì¼ì‹œ:</span>
                    <span className="text-sm text-navy-900">
                      {selectedReport.createdAt?.toDate ? 
                        selectedReport.createdAt.toDate().toLocaleString('ko-KR') : 
                        '-'
                      }
                    </span>
                  </div>
                </div>
              </div>

              {/* ì‹ ê³  ì‚¬ìœ  */}
              <div>
                <h4 className="font-semibold text-navy-900 mb-2">ğŸ’¬ ì‹ ê³  ì‚¬ìœ </h4>
                <div className="bg-navy-50 rounded-lg p-4">
                  <p className="text-sm text-navy-700">
                    {selectedReport.reason || 'ì‚¬ìœ ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'}
                  </p>
                </div>
              </div>

              {/* ì¡°ì¹˜ */}
              {selectedReport.status === 'pending' && (
                <div>
                  <h4 className="font-semibold text-navy-900 mb-2">âš™ï¸ ì¡°ì¹˜</h4>
                  <div className="flex gap-2">
                    <button
                      onClick={() => handleUpdateStatus(selectedReport.id, 'processing', 'ì²˜ë¦¬ì¤‘ìœ¼ë¡œ ë³€ê²½')}
                      className="flex-1 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors font-medium"
                    >
                      ì²˜ë¦¬ì¤‘
                    </button>
                    <button
                      onClick={() => handleDeleteContent(selectedReport)}
                      className="flex-1 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium"
                    >
                      ì½˜í…ì¸  ì‚­ì œ
                    </button>
                    <button
                      onClick={() => handleUpdateStatus(selectedReport.id, 'dismissed', 'ë¬´ì‹œ')}
                      className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                    >
                      ë¬´ì‹œ
                    </button>
                  </div>
                </div>
              )}

              {selectedReport.status !== 'pending' && (
                <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                  <p className="text-sm text-green-800 font-medium">
                    âœ“ ì´ ì‹ ê³ ëŠ” ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤
                  </p>
                  {selectedReport.adminNote && (
                    <p className="text-xs text-green-700 mt-1">
                      ë©”ëª¨: {selectedReport.adminNote}
                    </p>
                  )}
                </div>
              )}
            </div>
          </div>
        </div>
      )}
    </div>
  );
};



    // ========== Statistics Page ==========

const Statistics = () => {
  const db = window.firebaseDb;
  
  const [period, setPeriod] = useState('30'); // 7, 30, 90, all
  const [stats, setStats] = useState({
    totalUsers: 0,
    newUsers: 0,
    totalRuns: 0,
    newRuns: 0,
    totalCrews: 0,
    popularRaces: [],
    activityByDay: [],
  });
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadStatistics();
  }, [period]);

  const loadStatistics = async () => {
    try {
      // ê¸°ê°„ ê³„ì‚°
      const now = new Date();
      const periodDays = period === 'all' ? 999999 : parseInt(period);
      const startDate = new Date();
      startDate.setDate(startDate.getDate() - periodDays);

      // ì „ì²´ ì‚¬ìš©ì
      const allUsersSnapshot = await getDocs(collection(db, 'users'));
      const totalUsers = allUsersSnapshot.size;

      // ê¸°ê°„ ë‚´ ì‹ ê·œ ì‚¬ìš©ì
      const newUsersQuery = query(
        collection(db, 'users'),
        where('createdAt', '>=', Timestamp.fromDate(startDate))
      );
      const newUsersSnapshot = await getDocs(newUsersQuery);
      const newUsers = newUsersSnapshot.size;

      // ì „ì²´ ê¸°ë¡
      const allRunsSnapshot = await getDocs(collection(db, 'runs'));
      const totalRuns = allRunsSnapshot.size;
      const allRuns = allRunsSnapshot.docs.map(doc => doc.data());

      // ê¸°ê°„ ë‚´ ì‹ ê·œ ê¸°ë¡
      const newRunsQuery = query(
        collection(db, 'runs'),
        where('createdAt', '>=', Timestamp.fromDate(startDate))
      );
      const newRunsSnapshot = await getDocs(newRunsQuery);
      const newRuns = newRunsSnapshot.size;

      // í¬ë£¨ ìˆ˜
      let totalCrews = 0;
      try {
        const crewsSnapshot = await getDocs(collection(db, 'crews'));
        totalCrews = crewsSnapshot.size;
      } catch (e) {}

      // ì¸ê¸° ëŒ€íšŒ TOP 10
      const raceRuns = allRuns.filter(run => run.runType === 'race' && run.raceName);
      const raceCounts = {};
      raceRuns.forEach(run => {
        raceCounts[run.raceName] = (raceCounts[run.raceName] || 0) + 1;
      });
      const popularRaces = Object.entries(raceCounts)
        .map(([name, count]) => ({ name, count }))
        .sort((a, b) => b.count - a.count)
        .slice(0, 10);

      // ì¼ë³„ í™œë™ (ìµœê·¼ 30ì¼)
      const activityByDay = [];
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        date.setHours(0, 0, 0, 0);
        
        const nextDate = new Date(date);
        nextDate.setDate(nextDate.getDate() + 1);

        const dayRuns = allRuns.filter(run => {
          const runDate = run.createdAt?.toDate();
          return runDate && runDate >= date && runDate < nextDate;
        });

        activityByDay.push({
          date: date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' }),
          count: dayRuns.length
        });
      }

      setStats({
        totalUsers,
        newUsers,
        totalRuns,
        newRuns,
        totalCrews,
        popularRaces,
        activityByDay,
      });
    } catch (error) {
      console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  // CSV ë°ì´í„° ì¤€ë¹„
  const csvData = [
    ['í•­ëª©', 'ê°’'],
    ['ì „ì²´ ì‚¬ìš©ì', stats.totalUsers],
    ['ì‹ ê·œ ì‚¬ìš©ì', stats.newUsers],
    ['ì „ì²´ ê¸°ë¡', stats.totalRuns],
    ['ì‹ ê·œ ê¸°ë¡', stats.newRuns],
    ['ì „ì²´ í¬ë£¨', stats.totalCrews],
    [],
    ['ì¸ê¸° ëŒ€íšŒ TOP 10'],
    ['ìˆœìœ„', 'ëŒ€íšŒëª…', 'ê¸°ë¡ ìˆ˜'],
    ...stats.popularRaces.map((race, idx) => [idx + 1, race.name, race.count])
  ];

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
          <p className="text-navy-600">í†µê³„ ë°ì´í„° ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold text-navy-900">í†µê³„</h2>
          <p className="text-navy-600 mt-1">RunLog í™œë™ í†µê³„</p>
        </div>
        <button
          onClick={() => {
            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `runlog-statistics-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
          }}
          className="px-4 py-2 bg-navy-700 text-white rounded-lg hover:bg-navy-800 transition-colors font-medium"
        >
          CSV ë‹¤ìš´ë¡œë“œ
        </button>
      </div>

      {/* ê¸°ê°„ ì„ íƒ */}
      <div className="bg-white rounded-xl shadow-sm p-4">
        <div className="flex gap-2">
          <button
            onClick={() => setPeriod('7')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              period === '7'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ìµœê·¼ 7ì¼
          </button>
          <button
            onClick={() => setPeriod('30')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              period === '30'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ìµœê·¼ 30ì¼
          </button>
          <button
            onClick={() => setPeriod('90')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              period === '90'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ìµœê·¼ 90ì¼
          </button>
          <button
            onClick={() => setPeriod('all')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              period === 'all'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ì „ì²´
          </button>
        </div>
      </div>

      {/* ì£¼ìš” í†µê³„ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div className="bg-white rounded-xl shadow-sm p-6">
          <p className="text-sm text-navy-600 mb-1">ì „ì²´ ì‚¬ìš©ì</p>
          <h3 className="text-3xl font-bold text-navy-900 mb-2">
            {stats.totalUsers.toLocaleString()}
          </h3>
          <p className="text-xs text-green-600 font-semibold">
            +{stats.newUsers} (ê¸°ê°„ ë‚´)
          </p>
        </div>

        <div className="bg-white rounded-xl shadow-sm p-6">
          <p className="text-sm text-navy-600 mb-1">ì „ì²´ ê¸°ë¡</p>
          <h3 className="text-3xl font-bold text-navy-900 mb-2">
            {stats.totalRuns.toLocaleString()}
          </h3>
          <p className="text-xs text-green-600 font-semibold">
            +{stats.newRuns} (ê¸°ê°„ ë‚´)
          </p>
        </div>

        <div className="bg-white rounded-xl shadow-sm p-6">
          <p className="text-sm text-navy-600 mb-1">í‰ê·  ê¸°ë¡/ì‚¬ìš©ì</p>
          <h3 className="text-3xl font-bold text-navy-900 mb-2">
            {stats.totalUsers > 0 
              ? (stats.totalRuns / stats.totalUsers).toFixed(1)
              : '0'
            }
          </h3>
          <p className="text-xs text-navy-500">ê°œ</p>
        </div>

        <div className="bg-white rounded-xl shadow-sm p-6">
          <p className="text-sm text-navy-600 mb-1">ì „ì²´ í¬ë£¨</p>
          <h3 className="text-3xl font-bold text-navy-900 mb-2">
            {stats.totalCrews.toLocaleString()}
          </h3>
          <p className="text-xs text-navy-500">ê°œ</p>
        </div>
      </div>

      {/* ì¼ë³„ í™œë™ ì°¨íŠ¸ */}
      <div className="bg-white rounded-xl shadow-sm p-6">
        <h3 className="text-lg font-bold text-navy-900 mb-4">ğŸ“ˆ ì¼ë³„ ê¸°ë¡ ì¶”ê°€ (ìµœê·¼ 30ì¼)</h3>
        <div className="h-64 flex items-end gap-1">
          {stats.activityByDay.map((day, idx) => {
            const maxCount = Math.max(...stats.activityByDay.map(d => d.count), 1);
            const height = (day.count / maxCount) * 100;
            
            return (
              <div key={idx} className="flex-1 flex flex-col items-center">
                <div
                  className="w-full bg-navy-700 rounded-t transition-all hover:bg-navy-600"
                  style={{ height: `${height}%`, minHeight: day.count > 0 ? '4px' : '0' }}
                  title={`${day.date}: ${day.count}ê°œ`}
                />
                {idx % 5 === 0 && (
                  <p className="text-xs text-navy-500 mt-2 rotate-45 origin-left">
                    {day.date}
                  </p>
                )}
              </div>
            );
          })}
        </div>
      </div>

      {/* ì¸ê¸° ëŒ€íšŒ */}
      <div className="bg-white rounded-xl shadow-sm p-6">
        <h3 className="text-lg font-bold text-navy-900 mb-4">ğŸ† ì¸ê¸° ëŒ€íšŒ TOP 10</h3>
        {stats.popularRaces.length === 0 ? (
          <p className="text-center text-navy-500 py-8">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
        ) : (
          <div className="space-y-3">
            {stats.popularRaces.map((race, idx) => (
              <div key={idx} className="flex items-center gap-4">
                <div className={`flex items-center justify-center w-8 h-8 rounded-full font-bold text-white ${
                  idx === 0 ? 'bg-yellow-500' :
                  idx === 1 ? 'bg-gray-400' :
                  idx === 2 ? 'bg-orange-600' :
                  'bg-navy-700'
                }`}>
                  {idx + 1}
                </div>
                <div className="flex-1">
                  <p className="font-medium text-navy-900">{race.name}</p>
                  <div className="w-full bg-navy-100 rounded-full h-2 mt-1">
                    <div
                      className="bg-navy-700 h-2 rounded-full transition-all"
                      style={{ 
                        width: `${(race.count / stats.popularRaces[0].count) * 100}%` 
                      }}
                    />
                  </div>
                </div>
                <div className="text-right">
                  <p className="text-lg font-bold text-navy-900">{race.count}</p>
                  <p className="text-xs text-navy-500">ê¸°ë¡</p>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
};



    // ========== Settings Page ==========

const Settings = () => {
  const db = window.firebaseDb;
  
  const [activeTab, setActiveTab] = useState('notices'); // notices, races
  const [loading, setLoading] = useState(false);

  // ê³µì§€ì‚¬í•­
  const [notices, setNotices] = useState([]);
  const [newNotice, setNewNotice] = useState({ title: '', content: '' });
  const [editingNotice, setEditingNotice] = useState(null);

  // ëŒ€íšŒ ë°ì´í„°
  const [races, setRaces] = useState([]);
  const [newRace, setNewRace] = useState({ name: '', date: '' });

  useEffect(() => {
    if (activeTab === 'notices') {
      loadNotices();
    } else if (activeTab === 'races') {
      loadRaces();
    }
  }, [activeTab]);

  const loadNotices = async () => {
    try {
      const snapshot = await getDocs(collection(db, 'notices'));
      const noticesData = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      setNotices(noticesData.sort((a, b) => 
        (b.createdAt?.toDate() || 0) - (a.createdAt?.toDate() || 0)
      ));
    } catch (error) {
      console.error('ê³µì§€ì‚¬í•­ ë¡œë“œ ì‹¤íŒ¨:', error);
      setNotices([]);
    }
  };

  const loadRaces = async () => {
    try {
      const snapshot = await getDocs(collection(db, 'raceData'));
      const racesData = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      setRaces(racesData.sort((a, b) => 
        new Date(b.date) - new Date(a.date)
      ));
    } catch (error) {
      console.error('ëŒ€íšŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
      setRaces([]);
    }
  };

  const handleAddNotice = async (e) => {
    e.preventDefault();
    if (!newNotice.title.trim() || !newNotice.content.trim()) {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    setLoading(true);
    try {
      const noticeRef = doc(collection(db, 'notices'));
      await setDoc(noticeRef, {
        title: newNotice.title,
        content: newNotice.content,
        createdAt: Timestamp.now(),
        active: true
      });

      alert('ê³µì§€ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setNewNotice({ title: '', content: '' });
      loadNotices();
    } catch (error) {
      console.error('ê³µì§€ì‚¬í•­ ì¶”ê°€ ì‹¤íŒ¨:', error);
      alert('ê³µì§€ì‚¬í•­ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  const handleDeleteNotice = async (noticeId) => {
    if (!confirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      return;
    }

    try {
      await deleteDoc(doc(db, 'notices', noticeId));
      alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      loadNotices();
    } catch (error) {
      console.error('ê³µì§€ì‚¬í•­ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ê³µì§€ì‚¬í•­ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleAddRace = async (e) => {
    e.preventDefault();
    if (!newRace.name.trim() || !newRace.date) {
      alert('ëŒ€íšŒëª…ê³¼ ë‚ ì§œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    setLoading(true);
    try {
      const raceRef = doc(collection(db, 'raceData'));
      await setDoc(raceRef, {
        name: newRace.name,
        date: newRace.date,
        createdAt: Timestamp.now()
      });

      alert('ëŒ€íšŒê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setNewRace({ name: '', date: '' });
      loadRaces();
    } catch (error) {
      console.error('ëŒ€íšŒ ì¶”ê°€ ì‹¤íŒ¨:', error);
      alert('ëŒ€íšŒ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  const handleDeleteRace = async (raceId) => {
    if (!confirm('ì´ ëŒ€íšŒë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      return;
    }

    try {
      await deleteDoc(doc(db, 'raceData', raceId));
      alert('ëŒ€íšŒê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      loadRaces();
    } catch (error) {
      console.error('ëŒ€íšŒ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ëŒ€íšŒ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-bold text-navy-900">ì„¤ì •</h2>
        <p className="text-navy-600 mt-1">ì•± ì„¤ì • ê´€ë¦¬</p>
      </div>

      {/* íƒ­ */}
      <div className="bg-white rounded-xl shadow-sm p-4">
        <div className="flex gap-2">
          <button
            onClick={() => setActiveTab('notices')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              activeTab === 'notices'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ğŸ“¢ ê³µì§€ì‚¬í•­
          </button>
          <button
            onClick={() => setActiveTab('races')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              activeTab === 'races'
                ? 'bg-navy-700 text-white'
                : 'bg-navy-100 text-navy-700 hover:bg-navy-200'
            }`}
          >
            ğŸ† ëŒ€íšŒ ë°ì´í„°
          </button>
        </div>
      </div>

      {/* ê³µì§€ì‚¬í•­ íƒ­ */}
      {activeTab === 'notices' && (
        <div className="space-y-6">
          {/* ê³µì§€ì‚¬í•­ ì¶”ê°€ */}
          <div className="bg-white rounded-xl shadow-sm p-6">
            <h3 className="text-lg font-bold text-navy-900 mb-4">ìƒˆ ê³µì§€ì‚¬í•­ ì¶”ê°€</h3>
            <form onSubmit={handleAddNotice} className="space-y-4">
              <div>
                <label className="block text-sm font-semibold text-navy-700 mb-2">
                  ì œëª©
                </label>
                <input
                  type="text"
                  value={newNotice.title}
                  onChange={(e) => setNewNotice({ ...newNotice, title: e.target.value })}
                  className="w-full px-4 py-2 border-2 border-navy-200 rounded-lg focus:border-navy-600 focus:outline-none"
                  placeholder="ê³µì§€ì‚¬í•­ ì œëª©"
                  required
                />
              </div>
              <div>
                <label className="block text-sm font-semibold text-navy-700 mb-2">
                  ë‚´ìš©
                </label>
                <textarea
                  value={newNotice.content}
                  onChange={(e) => setNewNotice({ ...newNotice, content: e.target.value })}
                  className="w-full px-4 py-2 border-2 border-navy-200 rounded-lg focus:border-navy-600 focus:outline-none"
                  rows="4"
                  placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©"
                  required
                />
              </div>
              <button
                type="submit"
                disabled={loading}
                className="w-full px-4 py-2 bg-navy-700 text-white rounded-lg hover:bg-navy-800 transition-colors font-medium disabled:opacity-50"
              >
                {loading ? 'ì¶”ê°€ ì¤‘...' : 'ê³µì§€ì‚¬í•­ ì¶”ê°€'}
              </button>
            </form>
          </div>

          {/* ê³µì§€ì‚¬í•­ ëª©ë¡ */}
          <div className="bg-white rounded-xl shadow-sm p-6">
            <h3 className="text-lg font-bold text-navy-900 mb-4">
              ê³µì§€ì‚¬í•­ ëª©ë¡ ({notices.length}ê°œ)
            </h3>
            {notices.length === 0 ? (
              <p className="text-center text-navy-500 py-8">ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>
            ) : (
              <div className="space-y-3">
                {notices.map((notice) => (
                  <div key={notice.id} className="border border-navy-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-2">
                      <h4 className="font-bold text-navy-900">{notice.title}</h4>
                      <button
                        onClick={() => handleDeleteNotice(notice.id)}
                        className="text-red-600 hover:text-red-800 text-sm font-medium"
                      >
                        ì‚­ì œ
                      </button>
                    </div>
                    <p className="text-sm text-navy-700 mb-2">{notice.content}</p>
                    <p className="text-xs text-navy-500">
                      {notice.createdAt?.toDate ? 
                        notice.createdAt.toDate().toLocaleDateString('ko-KR', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric'
                        }) : 
                        '-'
                      }
                    </p>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      )}

      {/* ëŒ€íšŒ ë°ì´í„° íƒ­ */}
      {activeTab === 'races' && (
        <div className="space-y-6">
          {/* ëŒ€íšŒ ì¶”ê°€ */}
          <div className="bg-white rounded-xl shadow-sm p-6">
            <h3 className="text-lg font-bold text-navy-900 mb-4">ìƒˆ ëŒ€íšŒ ì¶”ê°€</h3>
            <form onSubmit={handleAddRace} className="space-y-4">
              <div>
                <label className="block text-sm font-semibold text-navy-700 mb-2">
                  ëŒ€íšŒëª…
                </label>
                <input
                  type="text"
                  value={newRace.name}
                  onChange={(e) => setNewRace({ ...newRace, name: e.target.value })}
                  className="w-full px-4 py-2 border-2 border-navy-200 rounded-lg focus:border-navy-600 focus:outline-none"
                  placeholder="ì˜ˆ: ì„œìš¸êµ­ì œë§ˆë¼í†¤"
                  required
                />
              </div>
              <div>
                <label className="block text-sm font-semibold text-navy-700 mb-2">
                  ë‚ ì§œ
                </label>
                <input
                  type="date"
                  value={newRace.date}
                  onChange={(e) => setNewRace({ ...newRace, date: e.target.value })}
                  className="w-full px-4 py-2 border-2 border-navy-200 rounded-lg focus:border-navy-600 focus:outline-none"
                  required
                />
              </div>
              <button
                type="submit"
                disabled={loading}
                className="w-full px-4 py-2 bg-navy-700 text-white rounded-lg hover:bg-navy-800 transition-colors font-medium disabled:opacity-50"
              >
                {loading ? 'ì¶”ê°€ ì¤‘...' : 'ëŒ€íšŒ ì¶”ê°€'}
              </button>
            </form>
          </div>

          {/* ëŒ€íšŒ ëª©ë¡ */}
          <div className="bg-white rounded-xl shadow-sm p-6">
            <h3 className="text-lg font-bold text-navy-900 mb-4">
              ëŒ€íšŒ ëª©ë¡ ({races.length}ê°œ)
            </h3>
            {races.length === 0 ? (
              <p className="text-center text-navy-500 py-8">ë“±ë¡ëœ ëŒ€íšŒê°€ ì—†ìŠµë‹ˆë‹¤</p>
            ) : (
              <div className="space-y-2">
                {races.map((race) => (
                  <div key={race.id} className="flex items-center justify-between p-3 border border-navy-200 rounded-lg hover:bg-navy-50 transition-colors">
                    <div>
                      <p className="font-medium text-navy-900">{race.name}</p>
                      <p className="text-sm text-navy-600">{race.date}</p>
                    </div>
                    <button
                      onClick={() => handleDeleteRace(race.id)}
                      className="px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors text-sm font-medium"
                    >
                      ì‚­ì œ
                    </button>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
};



    // ========== Admin App Component ==========
    const AdminApp = () => {
      const [currentPage, setCurrentPage] = useState('dashboard');
      const [selectedUserId, setSelectedUserId] = useState(null);
      const { isAdmin, loading } = useAdminAuth();

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-navy-50">
            <div className="text-center">
              <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-navy-700 border-t-transparent mb-4"></div>
              <p className="text-navy-600">ê¶Œí•œ í™•ì¸ ì¤‘...</p>
            </div>
          </div>
        );
      }

      if (!isAdmin) {
        window.location.href = '/';
        return null;
      }

      const renderPage = () => {
        if (currentPage === 'dashboard') return <AdminDashboard setCurrentPage={setCurrentPage} />;
        if (currentPage === 'users') return <UserManagement setCurrentPage={setCurrentPage} setSelectedUserId={setSelectedUserId} />;
        if (currentPage === 'user-detail') return <UserDetail selectedUserId={selectedUserId} setCurrentPage={setCurrentPage} />;
        if (currentPage === 'content') return <ContentManagement />;
        if (currentPage === 'crews') return <CrewManagement />;
        if (currentPage === 'reports') return <ReportManagement />;
        if (currentPage === 'statistics') return <Statistics />;
        if (currentPage === 'settings') return <Settings />;
        return <AdminDashboard setCurrentPage={setCurrentPage} />;
      };

      return (
        <div className="min-h-screen bg-navy-50">
          <header className="bg-white shadow-sm sticky top-0 z-30">
            <div className="px-6 py-4 flex items-center justify-between">
              <div>
                <h1 className="text-2xl font-bold text-navy-900">ğŸƒ RunLog Admin</h1>
                <p className="text-sm text-navy-600 mt-1">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
              </div>
              <div className="flex items-center gap-4">
                <button
                  onClick={() => window.location.href = '/'}
                  className="px-4 py-2 text-navy-700 hover:bg-navy-100 rounded-lg transition-colors"
                >
                  ë©”ì¸ìœ¼ë¡œ
                </button>
                <button
                  onClick={async () => {
                    if (!window.confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                      return;
                    }
                    
                    try {
                      await signOut(auth);
                      window.location.href = '/';
                    } catch (error) {
                      console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
                    }
                  }}
                  className="px-4 py-2 bg-navy-700 text-white rounded-lg hover:bg-navy-800 transition-colors"
                >
                  ë¡œê·¸ì•„ì›ƒ
                </button>
              </div>
            </div>
          </header>

          <div className="flex">
            <AdminSidebar currentPage={currentPage} setCurrentPage={setCurrentPage} />
            <main className="flex-1 p-6">
              {renderPage()}
            </main>
          </div>
        </div>
      );
    };

    // ========== Render App ==========
    const root = ReactDOM.createRoot(document.getElementById('admin-root'));
    root.render(<AdminApp />);
  </script>
</body>
</html>
